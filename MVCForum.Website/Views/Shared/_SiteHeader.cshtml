@model MvcForum.Web.ViewModels.Shared.SiteHeaderViewModel
@using MvcForum.Web.Application.ExtensionMethods
@using MvcForum.Web.ViewModels.Shared
@{
    var searchFor = Html.Lang("Side.Search.SearchFor");
}

<header id="nav" class="c-site-header js-site-header-nav">
    <h1 class="u-visually-hidden">Home</h1>
    <div class="c-skip-links">
        <p class="c-skip-links_item">
            <a href="#main-nav" class="c-skip-links_link">Skip to main navigation</a>
        </p>
        <p class="c-skip-links_item">
            <a href="#main" class="c-skip-links_link">Skip to main content</a>
        </p>
    </div>
    <div class="l-container c-site-header_content">
        <a href="/" class="c-site-header_logo">
            <img src="/UI/assets/dist/img/content/logo.svg" alt="Future NHS home page">
        </a>
        <div id="navigation" class="c-site-header_nav c-site-header-nav">
            <details class="c-site-header-nav_content" open="">
                <summary aria-haspopup="true" class="c-site-header-nav_mobile-trigger c-site-header-nav_mobile-trigger--right">
                    Menu
                </summary>
                <div class="c-site-header-nav_desktop-container">
                    <form method="get" action="/search/" class="c-site-header-nav_search-wrapper">
                        <div class="c-site-header-nav_search-item">
                            <label class="u-visually-hidden" for="siteSearch">Search the NHS website</label>
                            <!-- INPUT NEEDS HOOKING UP TO SEARCH - WORKS WITH ID OF "term" BUT NEEDS TO WORK WITH THIS ID INSTEAD -->
                            @Html.TextBox("siteSearch", null, new { @class = "c-site-header-nav_search-input", placeholder = searchFor, type = "search", aria_label = "Search site"  })
                            <button type="submit" aria-label="Site search button" class="c-site-header-nav_search-button">
                                @{Html.RenderPartial("_SVGIcon", new SVGIconViewModel("icon-search", "c-site-header-nav_search-button-icon js-svg"));}                
                            </button>
                        </div>
                    </form>
                    <nav id="header-nav" class="c-site-header-nav_nav" aria-label="Navigation">
                        <ul class="c-site-header-nav_root-nav c-site-header-nav_root-nav--mobile-full-height" role="menubar">
                            
                            @if (!User.Identity.IsAuthenticated)
                            {
                                <li role="none">
                                    <a role="menuitem" class="c-button c-site-header-nav_header-button" href="@Url.Action("LogOn", "Members")">@Html.LanguageString("Layout.Nav.Logon")</a>
                                </li>

                                if (Html.Settings().SuspendRegistration != true)
                                {
                                    <li role="none">
                                        <a role="menuitem" class="c-button c-site-header-nav_header-button c-site-header-nav_header-button--outline" href="@Url.Action("Register", "Members")">@Html.LanguageString("Layout.Nav.Register")</a>
                                    </li>
                                }
                            }                        
                            @if (User.Identity.IsAuthenticated)
                            {
                                <li role="none">
                                    <details class="c-site-header-nav_root-nav-item">
                                        <summary aria-haspopup="true" class="c-site-header-nav_root-nav-trigger" data-open-icon="icon-minus" data-closed-icon="icon-plus">

                                            @if (!string.IsNullOrEmpty(Model.CurrentUser.Avatar))
                                            {
                                                <span class="c-site-header-nav_root-nav-image">
                                                    <img src="@Model.CurrentUser.MemberImage(ForumConfiguration.Instance.GravatarPostSize)" alt="@Model.CurrentUser.UserName">
                                                </span>
                                            }
                                            else
                                            {
                                                @* TODO [FED]: The initials of the user (valiue in img tag alt) should be displayed if no image *@
                                                @Html.DisplayFor(x => Model.CurrentUser.Initials)
                                            }
                                            @Model.CurrentUser.GetFullName()
                                            @{Html.RenderPartial("_SVGIcon", new SVGIconViewModel("icon-plus", "c-site-header-nav_root-nav-icon js-svg"));}
                                        </summary>
                                        <div class="c-site-header-nav_sub-nav">
                                            <div class="c-site-header-nav_sub-nav-content">
                                                <div class="l-row">
                                                    <ul class="u-list-plain" role="menu" aria-label="Account navigation">
                                                        @Html.Action("SideAdminPanel", "Members", new { isDropDown = false })
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </details>
                                </li>
                                
                            }

                            <li role="none" class="u-desktop-hidden">
                                <details class="c-site-header-nav_root-nav-item">
                                    <summary aria-haspopup="true" class="c-site-header-nav_root-nav-trigger" data-open-icon="icon-minus" data-closed-icon="icon-plus">
                                        @{Html.RenderPartial("_SVGIcon", new SVGIconViewModel("icon-home", "c-site-header-nav_root-nav-content-icon"));} 
                                        Groups
                                        @{Html.RenderPartial("_SVGIcon", new SVGIconViewModel("icon-plus", "c-site-header-nav_root-nav-icon js-svg"));} 
                                    </summary>
                                    <div class="c-site-header-nav_sub-nav">
                                        <div class="c-site-header-nav_sub-nav-content">
                                            <div class="l-row">
                                                <ul class="u-list-plain" role="menu" aria-label="Your bill">
                                                    <li class="c-site-header-nav_sub-nav-item l-col-12" role="none">
                                                        <a role="menuitem" href="/" class="c-site-header-nav_sub-nav-child">
                                                            Group home
                                                        </a>
                                                    </li>
                                                    <li class="c-site-header-nav_sub-nav-item l-col-12" role="none">
                                                        <a role="menuitem" href="@Url.Action("Activity", "Home")" class="c-site-header-nav_sub-nav-child">
                                                             Group forum
                                                        </a>
                                                    </li>
                                                    <li class="c-site-header-nav_sub-nav-item l-col-12" role="none">
                                                        <a role="menuitem" href="" class="c-site-header-nav_sub-nav-child">
                                                             Members
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </details>
                            </li>
                            <li role="none" class="u-desktop-hidden">
                                <a role="menuitem" href="/" class="c-site-header-nav_root-nav-trigger">
                                    @{Html.RenderPartial("_SVGIcon", new SVGIconViewModel("icon-star", "c-site-header-nav_root-nav-content-icon"));} 
                                    Favourites
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </details>
        </div>
    </div>
</header>